# DeepSeek Chat 插件文档

## 插件信息
- 名称: DeepSeek Chat
- 版本: 1.0.0
- 基于: DeepSeek-V3 模型

## 功能简介
DeepSeek Chat 是一个基于 DeepSeek-V3 模型的对话插件,支持上下文记忆功能,可以在群聊中进行智能对话。

## 特性
- 支持多轮对话记忆
- 自动管理对话历史
- Token 限制保护
- 重试机制
- 异步处理

## 配置说明

### 配置文件
配置文件位置: `config.json`

```json
{
  "others": {
    "deepseek_key": "your_api_key_here"
  }
}
```

### 参数说明
- `max_history`: 保留最近 5 轮对话
- `max_tokens`: 最大 token 限制为 2048
- `timeout`: API 请求超时时间为 30 秒
- `retries`: 失败重试次数为 2 次

## 使用方法

### 基本对话
发送格式:
```
671b 你的问题
```

示例:
```
671b 你好
```

### 清除对话历史
发送:
```
671b 清除记忆
```

## 记忆系统说明

### 存储结构
- 使用嵌套字典存储对话历史
- 按群号和用户 ID 分别保存
- 自动维护对话轮次和 Token 限制

### 历史记录格式
```python
{
    "role": "user/assistant",
    "content": "消息内容"
}
```

## 响应格式
- 等待提示: ⌛ 正在查询深度记忆库（最近5轮对话）...
- 成功响应: 🔍 DeepSeek回复（基于X轮历史）：[回复内容]
- 错误响应: ❌ 记忆库访问失败：[错误信息]

## 错误处理
插件会处理以下异常情况:
- API 请求超时
- 网络连接错误
- API 响应异常
- Token 超限

## 依赖项
- aiohttp
- asyncio
- Hyper 框架

## 注意事项
1. 需要配置有效的 DeepSeek API Key
2. 注意控制单次提问的长度
3. 如果对话异常可以尝试清除记忆后重试
4. 建议在对话结束后主动清除历史记录

## 技术实现
- 异步 HTTP 请求
- 默认字典实现的记忆系统
- 自动化的历史记录管理
- 事件驱动的消息处理